{"name":"Rxflux","tagline":"RxFlux is a small framework in order to follow Flux design pattern with RxJava functionalities","body":"## Introduction\r\nRxFlux is small light-weight framework that makes it easy to follow the [Flux pattern](https://facebook.github.io/flux/docs/overview.html) with RxJava functionalities.\r\n\r\nIn order to understand more how to use Flux pattern in Android [@lgvalle](https://github.com/lgvalle) created a nice [example and explanation](https://github.com/lgvalle/android-flux-todo-app). I would recommend to read it before continuing.\r\n\r\n## Usage\r\n\r\nGradle:\r\n```\r\nTODO when the first version is uploaded to maven update here the explanation.\r\n```\r\n\r\nIMPORTANT in order to follow the instructions is highly recommended to look at the example provided in the repo.\r\n\r\nThe main class is the RxFlux, is the responsible to handle activity lifecycle in order to notify and register stores and views. \r\n\r\nFirst thing you must do is in init RxFlux in your Application instance\r\n```java\r\npublic void onCreate() {\r\n    super.onCreate();\r\n    rxFlux = RxFlux.init();\r\n}\r\n``` \r\n\r\nThis will make RxFlux register into the activity lifecycle and init the internal classes.\r\n\r\nFrom now on we will follow the image below to understand each step\r\n![Flux architecture](https://raw.githubusercontent.com/lgvalle/lgvalle.github.io/master/public/images/flux-graph-complete.png)\r\n\r\n### View\r\nEach activity of your app must implements RxViewDispatch. This interface defines the methods needed for each view (on Android it applies for our Activity). \r\n\r\nRxFlux will notify each activity that implements RxViewDispatch during the creation of it and will call ```onRxStoresRegister()``` in this method we must call the instance of the needed stores and register them.\r\n\r\nFor example: (see stores section for more)\r\n```java\r\n@Override\r\n  public void onRxStoresRegister() {\r\n    repositoriesStore = RepositoriesStore.get(mDispatcher);\r\n    repositoriesStore.register();\r\n}\r\n```\r\n\r\nRxFlux will register store change for each activity during the ```onResume``` method and then call ```onRxViewRegistered()``` so we can register the activity fragments or custom views. (Todo see how to register)\r\n\r\n```onRxStoreChanged(RxStoreChange change)``` here we will get notified by any store change that occurs in our app. For that reasons we must filter by storeId to identify which store has change.\r\n\r\n```java\r\n  @Override\r\n  public void onRxStoreChanged(RxStoreChange change) {\r\n    switch (change.getStoreId()) {\r\n      case RepositoriesStore.ID:\r\n        // Identify which type of action was and update view according to that\r\n        break;\r\n    }\r\n  }\r\n```\r\nFinally we should implement the ```onRxError(RxError error)``` it will notify when and error has occurred, so we can get the action used for it and the throwable instance, and for example retry the action. \r\n\r\n### RxActionCreator\r\n\r\nNext step is to create our ActionsCreator in order to do so, we create a new class and extends the RxActionCreator.\r\nBasically this abstract class will provide us with some extra functionality to handle the creation of the actions and the request.\r\n\r\nThe recommended way is to create and interface that defines the type of Actions and the methods. Following the example we can see we have the following interface.\r\n\r\n```java\r\npublic interface Actions {\r\n\r\n  String GET_PUBLIC_REPOS = \"get_public_repos\";\r\n  String GET_USER = \"get_user\";\r\n\r\n  void getPublicRepositories();\r\n\r\n  void getUserDetails(String userId);\r\n}\r\n```\r\n\r\nThen our ActionsCreator will look like:\r\n```java\r\npublic class GitHubActionCreator extends RxActionCreator implements Actions { \r\n   ...\r\n}\r\n```\r\n\r\nThe construction will need the instance of the Dispatcher and SubscriptionManager that you can get from RxFlux.\r\nThe SubscriptionManager is an important class that handles subscriptions by tag, the tag is the hashCode of the RxAction that we create, this will help us to avoid duplicated action running in the same time and make sure we unsubscribe from the Subscriptions whenever the app close. Also allows us a simple mechanism to cancel request.\r\n\r\nThe RxActionCreator offer the following methods:\r\n\r\n* ```boolean hasRxAction(RxAction rxAction)``` Checks if there is already and action running.\r\n* ```void removeRxAction(RxAction rxAction)``` Remove the specific action if exists\r\n* ```RxAction newRxAction(@NonNull String actionId, @NonNull Object... data)``` Creates a new \r\nRxAction with the specific actionId and the data. This object must be a key-value pair i.e newRxAction(GET_USER, Keys.ID, userId);\r\n* ```postRxAction(RxAction action)``` Will send the action into the dispatcher\r\n* ```postError(RxAction action, Throwable throwable)``` Creates a new RxError instance that \r\ncontains the RxAction created and the throwable instance then will post the error into the dispatcher so the store can react to it.\r\n\r\n### RxAction\r\n\r\nThis class represent an action of RxFlux, it contains the type and a key-value pair with the data. It's use to trigger events in the dispatcher.\r\n\r\n### RxStore \r\n\r\nThis class represents the Model + Logic of the app. In order to simplify the creation of it, every Store that we want to create must extends the abstract class. \r\n\r\nThe best way to use them is in a DI system or a singleton pattern. Once register to the dispatcher the store will get all the RxActions from the dispatcher, then we can filter by type and store the data, update our model or do the logic of our app, once this is done we should call postChange() to notify the View.\r\n\r\n```java\r\npublic class RepositoriesStore extends RxStore implements RepositoriesStoreInterface {\r\n\r\n  public static final String ID = \"RepositoriesStore\";\r\n  private static RepositoriesStore instance;\r\n  private ArrayList<GitHubRepo> gitHubRepos;\r\n\r\n  private RepositoriesStore(Dispatcher dispatcher) {\r\n    super(dispatcher);\r\n  }\r\n\r\n  public static synchronized RepositoriesStore get(Dispatcher dispatcher) {\r\n    if (instance == null) instance = new RepositoriesStore(dispatcher);\r\n    return instance;\r\n  }\r\n\r\n  @Override\r\n  public void onRxAction(RxAction action) {\r\n    switch (action.getType()) {\r\n      case Actions.GET_PUBLIC_REPOS:\r\n        this.gitHubRepos = (ArrayList<GitHubRepo>) action.getData().get(Keys.PUBLIC_REPOS);\r\n        break;\r\n      default: // IMPORTANT if we don't modify the store just ignore\r\n        return;\r\n    }\r\n    postChange(new RxStoreChange(ID, action));\r\n  }\r\n\r\n  @Override\r\n  public ArrayList<GitHubRepo> getRepositories() {\r\n    return gitHubRepos == null ? new ArrayList<GitHubRepo>() : gitHubRepos;\r\n  }\r\n}\r\n```\r\n\r\nFinally each store should provide an interface so the View can request the model. As you can see in the example we provide the getRepositories().\r\n\r\n## Final notes\r\n\r\nRxFlux just provide an easy way to implement Flux pattern, it requires manual integration and the developer must follow the Flux flow in order to work properly.\r\n\r\n**Pros:**\r\n* Clean architecture.\r\n* Simple flow.\r\n* Logic abstraction and well defined.\r\n* Simple to test.\r\n* Modular.\r\n* Reactive.\r\n* Easy to add Hooks, like tracking tools. \r\n\r\n**Contras:**\r\n* One way, restrictive flow.\r\n* Different pattern, needs to learn a bit before using it.\r\n\r\n## Author\r\nThis framework was developed by @skimarxall. It is being used in a private production environment. The idea of this framework came after reading the article of @lgvalle. \r\n\r\nThe contributions are totally welcome, but all the PR must follow the coding rules defined [here](https://github.com/square/java-code-styles/blob/master/configs/codestyles/SquareAndroid.xml).\r\n\r\n\r\nLicense\r\n=======\r\n\r\n    Copyright 2015 Marcel Pint√≥ Biescas\r\n\r\n    Licensed under the Apache License, Version 2.0 (the \"License\");\r\n    you may not use this file except in compliance with the License.\r\n    You may obtain a copy of the License at\r\n\r\n       http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n    Unless required by applicable law or agreed to in writing, software\r\n    distributed under the License is distributed on an \"AS IS\" BASIS,\r\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n    See the License for the specific language governing permissions and\r\n    limitations under the License.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}